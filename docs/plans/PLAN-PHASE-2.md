# Phase 2：订阅管理 CRUD

**目标：** 实现订阅的完整生命周期管理，用户可新增、编辑、删除、取消和重新激活订阅。

---

## 任务清单

### 2.1 核心工具函数

- 品牌色映射表 + 模糊匹配函数（名称包含关键词即匹配）
- 下次扣款日计算函数（根据 startDate + cycle 推算最近未来日期）
- 预设分类 + 自定义分类合并逻辑，新分类颜色自动分配

**验收标准：**
- 输入"netflix"匹配到 #E50914，输入"abc"无匹配返回 null
- startDate 2025-01-15 + monthly → nextBillDate 2026-03-15（当前日期 2026-02-26）
- 新建分类自动分配预设色板中下一个颜色，色板循环复用

### 2.2 底部抽屉组件（SubscriptionDrawer）

- 遮罩层 + 底部滑入动画（CSS transition）
- 表单布局：名称、金额+币种、计费周期、起始日期、分类、颜色、备注
- 底部操作栏：新增模式（取消/保存）、编辑模式（取消/保存/标记取消或重新激活）
- 编辑模式下显示删除按钮（红色）

**验收标准：**
- 点击 FAB 打开抽屉，点击遮罩或取消关闭
- 表单所有字段可填写，必填校验生效
- 自定义周期选择后出现天数输入框

### 2.3 表单交互逻辑

- 名称输入时触发品牌色模糊匹配 → 自动更新颜色选择器
- 选择分类后，若无品牌色匹配则使用分类默认颜色
- 计费周期 + 起始日期选定后，自动显示"下次扣款日：xxxx-xx-xx"
- 分类选择器末尾有"+ 新分类"选项，点击弹出输入框
- 颜色选择器：提供预设色板供用户手动选择

**验收标准：**
- 输入"Spotify"后颜色自动变为 #1DB954
- 修改分类后颜色跟随（如未匹配品牌色）
- 下次扣款日实时计算并显示

### 2.4 订阅数据 CRUD

- 新增：生成 UUID + 计算 nextBillDate + 写入 localStorage
- 编辑：回填表单 → 修改 → 保存更新（updatedAt 更新）
- 删除：二次确认弹窗 → 确认后从列表移除
- 取消：status 改 cancelled + 记录 cancelledDate + nextBillDate 置空
- 重新激活：status 改 active + 清空 cancelledDate + 重算 nextBillDate

**验收标准：**
- 新增后列表中可见，刷新页面数据不丢失
- 编辑后数据正确更新
- 删除弹出确认，确认后项目消失
- 取消后卡片移到"已取消"列表，重新激活后回到"生效中"

### 2.5 订阅列表页（SubscriptionsView）

- 顶部筛选：生效中 / 已取消 Tab 切换
- 订阅卡片：左侧品牌色色块+首字母、名称、金额/周期、续费日、分类
- 已取消卡片灰度化处理，显示取消日期
- 点击卡片打开编辑抽屉

**验收标准：**
- 生效中/已取消 Tab 各自显示对应状态的订阅
- 卡片显示品牌色色块、首字母、名称、金额、周期、续费日
- 已取消卡片视觉灰度化
- 点击卡片进入编辑模式，表单回填正确

---

## 测试计划

手动验证：

- [ ] 点击 FAB "+" 打开底部抽屉，表单字段齐全（名称/金额+币种/周期/日期/分类/颜色/备注）
- [ ] 输入"Netflix" → 颜色自动变为红色（#E50914）
- [ ] 选择周期 + 起始日期后，下方显示下次扣款日
- [ ] 选择"自定义"周期后出现天数输入框
- [ ] 点"+ 新分类"可新建分类，颜色自动分配
- [ ] 保存后切到"订阅列表" Tab 可见卡片（品牌色色块 + 首字母 + 名称 + 金额/周期 + 续费日 + 分类）
- [ ] 新增一条自定义周期订阅，验证天数输入和折算
- [ ] 点击卡片进入编辑模式，数据回填正确
- [ ] 编辑订阅修改金额，保存后列表更新
- [ ] "标记为已取消" → 卡片移到"已取消"Tab，灰度化显示，显示取消日期
- [ ] "重新激活" → 回到"生效中"，nextBillDate 重新计算
- [ ] "删除" → 弹出确认弹窗 → 确认后项目消失
- [ ] 刷新页面，所有数据不丢失
