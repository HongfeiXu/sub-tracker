# SubTracker 总体开发计划

> 基于 PRD.md + ARCHITECTURE.md 生成 | 日期：2026-02-26

---

## 阶段总览

| 阶段 | 主题 | 核心产出 | 依赖 |
|------|------|---------|------|
| Phase 1 | 项目搭建 + 基础骨架 | 可运行的空壳应用，含主题切换 | 无 |
| Phase 2 | 订阅管理 CRUD | 完整的新增/编辑/删除/取消流程 | Phase 1 |
| Phase 3 | 总览仪表盘 | 统计卡片、环形图、即将扣款列表 | Phase 2 |
| Phase 4 | 设置 + 数据管理 + 收尾 | 导入导出、设置面板、空状态、响应式适配 | Phase 3 |

所有阶段串行，每个阶段产出可独立验证。

```
Phase 1 → Phase 2 → Phase 3 → Phase 4
```

---

## Phase 1：项目搭建 + 基础骨架

**目标：** 从零搭建项目，跑通技术栈，实现应用外壳和主题切换。

### 产出

- Vite + React + TypeScript + Tailwind CSS v4 项目可运行
- 应用外壳布局（Header + TabBar + FAB + 内容区占位）
- 暗色/浅色/跟随系统主题切换可用
- TypeScript 类型定义完成（Subscription、Category 等）
- localStorage 读写工具函数就绪
- 数据持久化：主题偏好可保存并恢复

### 具体任务

1. 初始化 Vite 项目，配置 TypeScript + Tailwind CSS v4 + `@tailwindcss/vite`
2. 定义 TypeScript 类型：`Subscription`、`Category`、`Currency`、`BillingCycle`、`ThemeMode` 等
3. 实现 localStorage 工具函数（读/写/清空，带类型约束）
4. 实现主题管理逻辑（auto/light/dark 切换，系统主题监听，`dark` class 切换）
5. 搭建应用外壳：Header（标题 + 齿轮图标占位）、TabBar（总览/订阅列表切换）、FAB 按钮
6. 应用暗色/浅色两套配色（参考 PRD 5.3 色彩体系）
7. Tab 切换功能可用（内容区显示占位文本）

### 风险

- **Tailwind v4 暗色模式配置**：v4 的 `@custom-variant` 写法与 v3 不同，需验证手动 `dark` class 切换是否正常工作
  - 缓解：Phase 1 优先验证此功能，不留到后面

---

## Phase 2：订阅管理 CRUD

**目标：** 实现订阅的完整生命周期管理，用户可新增、编辑、删除、取消和重新激活订阅。

### 依赖

- Phase 1 的类型定义、localStorage 工具、应用外壳

### 产出

- 底部抽屉表单（新增/编辑订阅）
- 订阅列表页（卡片展示，生效中/已取消筛选）
- 品牌色自动匹配
- 分类选择 + 新建分类
- 下次扣款日自动计算
- 数据 localStorage 持久化，刷新不丢失

### 具体任务

1. 实现品牌色映射表和模糊匹配函数
2. 实现下次扣款日计算函数（根据 startDate + cycle 推算最近未来日期）
3. 实现预设分类数据 + 自定义分类管理（合并逻辑、颜色自动分配）
4. 实现底部抽屉组件（SubscriptionDrawer）：打开/关闭动画，表单布局
5. 实现表单字段：名称（触发品牌色匹配）、金额+币种、计费周期、起始日期、分类选择器、颜色选择器、备注
6. 表单验证：必填校验、自定义周期天数校验
7. 新增订阅：生成 UUID、计算 nextBillDate、写入 localStorage
8. 编辑订阅：回填表单、保存更新
9. 删除订阅：二次确认弹窗、删除后刷新列表
10. 取消/重新激活：状态切换、cancelledDate 记录、nextBillDate 置空/重算
11. 实现订阅列表页（SubscriptionsView）：卡片渲染、左侧色块+首字母、金额/周期/续费日显示
12. 实现状态筛选：生效中/已取消 Tab 切换，已取消卡片灰度化

### 风险

- **底部抽屉交互**：纯 Tailwind 实现抽屉动画和遮罩层，不引入 UI 组件库
  - 缓解：使用 CSS transition + 条件渲染，保持实现简单

---

## Phase 3：总览仪表盘

**目标：** 实现 Dashboard 页面，用户打开即可看到支出统计和即将扣款。

### 依赖

- Phase 2 的订阅数据和计算函数

### 产出

- 月度/年度支出统计卡片（CNY/USD 分开显示）
- 分类占比环形图（Recharts）
- 即将扣款列表（30 天内优先，可展开全部）

### 具体任务

1. 实现支出折算函数：按 cycle 折算为月度/年度金额
2. 实现分币种汇总：按 currency 分组求和
3. 实现分类占比计算：按 category 分组，生成饼图数据
4. 引入 Recharts，实现环形图组件（中心显示总金额，按分类着色）
5. 实现统计卡片组件（StatsCard）：月度/年度金额展示 + 环形图
6. 实现即将扣款列表（UpcomingList）：按 nextBillDate 排序，显示"X 天后"/"今天"/"已过期"
7. 实现 30 天折叠逻辑：30 天内的默认展示，超出 30 天的折叠，点击"查看全部"展开
8. 移动端上下堆叠、桌面端左右并排的响应式布局

### 风险

- **Recharts 环形图定制**：中心文字叠加、按分类着色、双币种切换
  - 缓解：Recharts PieChart 支持 `innerRadius` 和自定义 label，文档成熟

---

## Phase 4：设置 + 数据管理 + 收尾

**目标：** 完成设置面板、数据导入导出，处理边界情况和视觉打磨。

### 依赖

- Phase 3（所有功能模块就绪）

### 产出

- 设置面板（主题切换 UI、导出、导入）
- JSON 导出/导入功能
- 空状态引导页
- 响应式布局最终适配（375px ~ 1440px）
- 视觉细节打磨

### 具体任务

1. 实现设置面板组件（SettingsPanel）：下拉/抽屉式，含关闭按钮
2. 主题切换 UI：三个 Segment 按钮（自动/浅色/深色），当前选中高亮
3. 实现 JSON 导出：生成文件结构（version + exportedAt + subscriptions + categories），触发浏览器下载
4. 实现 JSON 导入：文件选择器 → 解析 JSON → 确认弹窗（"将替换当前所有数据"） → 覆盖写入 → 刷新状态
5. 导入容错：校验 JSON 格式和必要字段，异常时提示用户
6. 实现空状态页面：无订阅时的引导文案 + 引导用户点击 FAB 添加
7. 响应式适配检查：移动端（375px）单列布局无溢出、桌面端（960px+）统计卡片并排
8. 视觉打磨：间距、圆角、字号层级、金额数字加粗、辅助信息降低对比度
9. 全流程走查：覆盖 PRD 六、验收标准中的所有 checklist 条目
